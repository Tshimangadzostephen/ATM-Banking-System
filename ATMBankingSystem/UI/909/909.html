<!DOCTYPE html>
<html>
<head>
    <title>State 909 - Transaction Complete</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #4CAF50 0%, #8BC34A 100%);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .complete-container {
            text-align: center;
            color: white;
            padding: 40px;
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .checkmark-circle {
            width: 150px;
            height: 150px;
            margin: 0 auto 30px;
            background: white;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            animation: popIn 0.5s ease-out;
        }

        @keyframes popIn {
            0% {
                transform: scale(0);
                opacity: 0;
            }

            50% {
                transform: scale(1.1);
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .checkmark {
            font-size: 80px;
            color: #4CAF50;
            animation: drawCheck 0.8s ease-out 0.3s;
            animation-fill-mode: both;
        }

        @keyframes drawCheck {
            from {
                transform: scale(0) rotate(-45deg);
            }

            to {
                transform: scale(1) rotate(0deg);
            }
        }

        .title {
            font-size: 36px;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .message {
            font-size: 20px;
            margin: 20px 0;
            opacity: 0.95;
        }

        .transaction-summary {
            margin: 30px auto;
            padding: 25px;
            background: rgba(255,255,255,0.15);
            border-radius: 15px;
            max-width: 400px;
            backdrop-filter: blur(10px);
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }

            .summary-item:last-child {
                border-bottom: none;
            }

        .summary-label {
            opacity: 0.9;
        }

        .summary-value {
            font-weight: bold;
        }

        .receipt-section {
            margin: 30px 0;
            padding: 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            animation: slideUp 0.5s ease-out 0.5s;
            animation-fill-mode: both;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .receipt-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }

        .countdown {
            margin: 30px 0;
            font-size: 18px;
        }

        .countdown-number {
            font-size: 36px;
            font-weight: bold;
            margin: 10px 0;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.1);
            }
        }

        .card-reminder {
            margin-top: 30px;
            padding: 20px;
            background: rgba(255,255,0,0.2);
            border-radius: 10px;
            font-size: 20px;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 50% {
                opacity: 1;
            }

            51%, 100% {
                opacity: 0.6;
            }
        }

        .thank-you {
            font-size: 24px;
            margin-top: 30px;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="complete-container">
        <div class="checkmark-circle">
            <div class="checkmark">✓</div>
        </div>

        <div class="title">Transaction Complete!</div>

        <div class="message">Your transaction has been processed successfully</div>

        <div class="transaction-summary" id="transactionSummary">
            <div class="summary-item">
                <span class="summary-label">Date:</span>
                <span class="summary-value" id="transDate">19/09/2025</span>
            </div>
            <div class="summary-item">
                <span class="summary-label">Time:</span>
                <span class="summary-value" id="transTime">14:35:22</span>
            </div>
            <div class="summary-item">
                <span class="summary-label">Card:</span>
                <span class="summary-value" id="cardNumber">****9012</span>
            </div>
            <div class="summary-item" id="amountRow">
                <span class="summary-label">Amount:</span>
                <span class="summary-value" id="transAmount">R0</span>
            </div>
            <div class="summary-item">
                <span class="summary-label">Auth Code:</span>
                <span class="summary-value" id="authCode">123456</span>
            </div>
        </div>

        <div class="receipt-section">
            <div class="receipt-icon">🧾</div>
            <div>Please take your receipt</div>
        </div>

        <div class="card-reminder">
            ⚠️ Please don't forget your card! ⚠️
        </div>

        <div class="countdown">
            Returning to welcome screen in
            <div class="countdown-number" id="countdown">5</div>
            seconds
        </div>

        <div class="thank-you">Thank you for banking with us!</div>
    </div>

    <script>
        var GrgApp = null;
        var GrgDataPool = null;
        var countdownTimer = null;
        var countdownValue = 5;
        var initialized = false;

        window.onload = function () {
            setTimeout(initializeState, 100);
        };

        function initializeState() {
            if (initialized) return;

            if (window.GetWebCtrl && typeof window.GetWebCtrl === "function") {
                try {
                    GrgApp = window.GetWebCtrl("GrgApp");
                    GrgDataPool = window.GetWebCtrl("GrgDataPool");

                    if (GrgApp && GrgDataPool) {
                        initialized = true;
                        OnStateEntry();
                        return;
                    }
                } catch (e) {
                    // retry silently
                }
            }

            setTimeout(initializeState, 100);
        }

        function OnStateEntry() {
            if (GrgApp) {
                GrgApp.LogEvent("Enter State 909 - Transaction Complete");
            }

            // Set current date/time
            var now = new Date();
            document.getElementById("transDate").innerText = now.toLocaleDateString('en-GB');
            document.getElementById("transTime").innerText = now.toLocaleTimeString('en-GB');

            // Display transaction details
            if (GrgDataPool) {
                var transType = GrgDataPool.GetData("TransactionType");
                var amount = GrgDataPool.GetData("Amount");
                var authCode = GrgDataPool.GetData("AuthCode");

                var cardNumber = GrgDataPool.GetData("CardNumber");
                var maskedCardNumber = "****" + cardNumber.slice(-4);
                document.getElementById("cardNumber").innerText = maskedCardNumber;

                if (transType === "WITHDRAWAL" || transType === "FASTCASH") {
                    document.getElementById("transAmount").innerText = "R" + (amount || "0");
                } else {
                    document.getElementById("amountRow").style.display = "none";
                }

                if (authCode) {
                    document.getElementById("authCode").innerText = authCode;
                }

                GrgApp.LogEvent("Transaction completed: " + transType);
            }

            // Simulate card ejection and receipt printing
            setTimeout(function () {
                if (GrgApp) GrgApp.LogEvent("Ejecting card");
            }, 1000);

            setTimeout(function () {
                if (GrgApp) GrgApp.LogEvent("Printing receipt");
            }, 2000);

            // Start 5-second countdown
            startCountdown();
        }

        function startCountdown() {
            countdownValue = 5;
            document.getElementById("countdown").innerText = countdownValue;

            countdownTimer = setInterval(function () {
                countdownValue--;
                document.getElementById("countdown").innerText = countdownValue;

                if (countdownValue <= 0) {
                    clearInterval(countdownTimer);
                    completeTransaction();
                }
            }, 1000);
        }

        function completeTransaction() {
            // Clear session data
            if (GrgDataPool) GrgDataPool.ClearData();

            if (GrgApp) {
                GrgApp.LogEvent("Returning to idle state");
                GrgApp.LoadState("000");
            }
        }

        function OnTimeout() {
            // This state auto-returns after countdown; no timeout logic needed
        }
    </script>

</body>
</html>